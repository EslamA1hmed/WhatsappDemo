<div class="dashboard-stats">
  <h2 class="stats-header">ðŸ“Š Messages Statistics</h2>

  <!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„ÙÙ„Ø§ØªØ± (ØªØ¨ÙˆÙŠØ¨Ø§Øª + Ø¬Ù‡Ø§Øª Ø§ØªØµØ§Ù„) -->
  <div class="filters-container">
    <!-- 1. Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù„Ø§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ© -->
    <div class="view-toggle">
      <button class="toggle-btn" 
              [class.active]="activeView === 'outgoing'"
              (click)="setView('outgoing')">
        ðŸ“¤ Outgoing
      </button>
      <button class="toggle-btn" 
              [class.active]="activeView === 'incoming'"
              (click)="setView('incoming')">
        ðŸ“¥ Incoming
      </button>
    </div>
    
    <!-- ÙÙ„ØªØ± Ø¬Ù‡Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ -->
    <div class="stats-filter-container">
      <label for="contact-select" class="filter-label">For:</label>
      <select id="contact-select" 
              class="contact-select" 
              [(ngModel)]="selectedContact" 
              (change)="onContactChange()">
        <option value="all">All Contacts</option>
        <option *ngFor="let contact of contacts" [value]="contact.phoneNumber">
          {{ contact.name || contact.phoneNumber }}
        </option>
      </select>
    </div>
  </div>
  
  <div *ngIf="loading" class="loading">
    <div class="spinner"></div>
    <div>Loading statistics...</div>
  </div>
  
  <div *ngIf="error" class="error">
    {{ error }}
  </div>
  
  <div *ngIf="!loading && !error">

    <!-- ================================== -->
    <!--   Ø¹Ø±Ø¶ Ù‚Ø³Ù… Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ØµØ§Ø¯Ø±Ø© (Ø´Ø±Ø·ÙŠÙ‹Ø§)   -->
    <!-- ================================== -->
    <div *ngIf="activeView === 'outgoing'" class="stats-section">
      <div class="total-card sent-card">
        <div class="total-icon">âž¤</div>
        <div class="total-info">
          <div class="total-label">Total Sent</div>
          <div class="total-value">{{ totalOutgoing }}</div>
        </div>
      </div>
      <div class="stats-grid">
        <div *ngFor="let stat of outgoingStats" class="stat-card" [style.border-left-color]="getStatusColor(stat.status)">
          <div class="stat-icon" [style.background-color]="getStatusColor(stat.status) + '20'"><span [style.color]="getStatusColor(stat.status)">{{ getStatusIcon(stat.status) }}</span></div>
          <div class="stat-details">
            <div class="stat-status">{{ stat.status }}</div>
            <div class="stat-count">{{ stat.count }}</div>
            <div class="stat-percentage">{{ getPercentage(stat.count, totalOutgoing) }}%</div>
          </div>
        </div>
      </div>
      <div class="pie-container" *ngIf="totalOutgoing > 0">
        <h3 class="chart-title">Status Breakdown</h3>
        <div class="pie-chart">
          <svg viewBox="0 0 200 200" class="pie-svg">
            <circle cx="100" cy="100" r="80" fill="none" stroke="#f0f0f0" stroke-width="40" />
            <ng-container *ngFor="let stat of outgoingStats; let i = index">
              <circle cx="100" cy="100" r="80" fill="none" [attr.stroke]="getStatusColor(stat.status)" stroke-width="40" [attr.stroke-dasharray]="getStrokeDashArray(stat.count, totalOutgoing)" [attr.stroke-dashoffset]="getStrokeDashOffset(i, outgoingStats, totalOutgoing)" transform="rotate(-90 100 100)" />
            </ng-container>
          </svg>
          <div class="pie-center"><div class="pie-total">{{ totalOutgoing }}</div><div class="pie-label">Sent</div></div>
        </div>
        <div class="pie-legend">
          <div *ngFor="let stat of outgoingStats" class="legend-item">
            <div class="legend-color" [style.background-color]="getStatusColor(stat.status)"></div>
            <div class="legend-text"><span class="legend-status">{{ stat.status }}</span><span class="legend-value">{{ stat.count }} ({{ getPercentage(stat.count, totalOutgoing) }}%)</span></div>
          </div>
        </div>
      </div>
      <div *ngIf="totalOutgoing === 0" class="no-data-chart">No outgoing messages to display.</div>
    </div>

    <!-- =================================== -->
    <!--   Ø¹Ø±Ø¶ Ù‚Ø³Ù… Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„ÙˆØ§Ø±Ø¯Ø© (Ø´Ø±Ø·ÙŠÙ‹Ø§)    -->
    <!-- =================================== -->
    <div *ngIf="activeView === 'incoming'" class="stats-section">
      <div class="total-card received-card">
        <div class="total-icon">âœ“</div>
        <div class="total-info">
          <div class="total-label">Total Received</div>
          <div class="total-value">{{ totalIncoming }}</div>
        </div>
      </div>
      <div class="stats-grid">
        <div *ngFor="let stat of incomingStats" class="stat-card" [style.border-left-color]="getStatusColor(stat.status)">
          <div class="stat-icon" [style.background-color]="getStatusColor(stat.status) + '20'"><span [style.color]="getStatusColor(stat.status)">{{ getTypeIcon(stat.status) }}</span></div>
          <div class="stat-details">
            <div class="stat-status">{{ stat.status }} Messages</div>
            <div class="stat-count">{{ stat.count }}</div>
            <div class="stat-percentage">{{ getPercentage(stat.count, totalIncoming) }}%</div>
          </div>
        </div>
      </div>
      <div class="pie-container" *ngIf="totalIncoming > 0">
        <h3 class="chart-title">Type Breakdown</h3>
        <div class="pie-chart">
          <svg viewBox="0 0 200 200" class="pie-svg">
            <circle cx="100" cy="100" r="80" fill="none" stroke="#f0f0f0" stroke-width="40" />
            <ng-container *ngFor="let stat of incomingStats; let i = index">
              <circle cx="100" cy="100" r="80" fill="none" [attr.stroke]="getStatusColor(stat.status)" stroke-width="40" [attr.stroke-dasharray]="getStrokeDashArray(stat.count, totalIncoming)" [attr.stroke-dashoffset]="getStrokeDashOffset(i, incomingStats, totalIncoming)" transform="rotate(-90 100 100)" />
            </ng-container>
          </svg>
          <div class="pie-center"><div class="pie-total">{{ totalIncoming }}</div><div class="pie-label">Received</div></div>
        </div>
        <div class="pie-legend">
          <div *ngFor="let stat of incomingStats" class="legend-item">
            <div class="legend-color" [style.background-color]="getStatusColor(stat.status)"></div>
            <div class="legend-text"><span class="legend-status">{{ stat.status }}</span><span class="legend-value">{{ stat.count }} ({{ getPercentage(stat.count, totalIncoming) }}%)</span></div>
          </div>
        </div>
      </div>
      <div *ngIf="totalIncoming === 0" class="no-data-chart">No incoming messages to display.</div>
    </div>
  </div>
</div>

